<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenOptimizer — Cutting Stock Optimizer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><g transform='translate(32,32)'><rect width='280' height='280' rx='20' fill='%23CE412B'/><rect x='300' width='148' height='448' rx='20' fill='%232C3E50'/><rect y='300' width='280' height='148' rx='20' fill='%23DEA584'/></g></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #f8fafc;
            --color-surface: #ffffff;
            --color-border: #e2e8f0;
            --color-border-hover: #cbd5e1;
            --color-text: #1e293b;
            --color-text-secondary: #64748b;
            --color-text-muted: #94a3b8;
            --color-primary: #0f172a;
            --color-primary-hover: #1e293b;
            --color-accent: #3b82f6;
            --color-accent-light: #eff6ff;
            --color-success: #10b981;
            --color-success-light: #ecfdf5;
            --color-danger: #ef4444;
            --color-danger-light: #fef2f2;
            --color-warning: #f59e0b;
            --color-warning-light: #fffbeb;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --transition: 150ms ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* Layout */
        .app {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .navbar {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--color-text);
        }

        .navbar-logo-img {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
        }

        .navbar-title {
            font-weight: 700;
            font-size: 18px;
            letter-spacing: -0.02em;
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 380px 1fr;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            background: var(--color-surface);
            border-right: 1px solid var(--color-border);
            overflow-y: auto;
            height: calc(100vh - 64px);
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid var(--color-border);
        }

        .sidebar-section:last-child {
            border-bottom: none;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .sidebar-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--color-text-secondary);
        }

        .sidebar-badge {
            background: var(--color-bg);
            color: var(--color-text-secondary);
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .results-area {
            overflow-y: auto;
            height: calc(100vh - 64px);
            padding: 24px;
            background: var(--color-bg);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text);
            margin-bottom: 6px;
        }

        .form-hint {
            font-size: 12px;
            color: var(--color-text-muted);
            margin-top: 4px;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            font-size: 14px;
            font-family: inherit;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            background: var(--color-surface);
            color: var(--color-text);
            transition: border-color var(--transition), box-shadow var(--transition);
        }

        .form-input::placeholder {
            color: var(--color-text-muted);
        }

        .form-input:hover {
            border-color: var(--color-border-hover);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 3px var(--color-accent-light);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .checkbox-field {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: var(--color-bg);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background var(--transition);
        }

        .checkbox-field:hover {
            background: var(--color-border);
        }

        .checkbox-field input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin-top: 2px;
            accent-color: var(--color-accent);
            cursor: pointer;
        }

        .checkbox-content {
            flex: 1;
        }

        .checkbox-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text);
            display: block;
            cursor: pointer;
        }

        .checkbox-hint {
            font-size: 12px;
            color: var(--color-text-muted);
            margin-top: 2px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition);
            text-decoration: none;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-block {
            width: 100%;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--color-primary-hover);
        }

        .btn-secondary {
            background: var(--color-bg);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--color-border);
            border-color: var(--color-border-hover);
        }

        .btn-ghost {
            background: transparent;
            color: var(--color-text-secondary);
            padding: 8px;
        }

        .btn-ghost:hover:not(:disabled) {
            background: var(--color-bg);
            color: var(--color-text);
        }

        .btn-danger {
            background: var(--color-danger-light);
            color: var(--color-danger);
        }

        .btn-danger:hover:not(:disabled) {
            background: var(--color-danger);
            color: white;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
        }

        .btn-icon {
            padding: 8px;
            width: 32px;
            height: 32px;
        }

        .btn-icon svg {
            width: 16px;
            height: 16px;
        }

        /* Cards & Lists */
        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
        }

        .card-body {
            padding: 20px;
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .item-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: var(--color-bg);
            border-radius: var(--radius-md);
            transition: background var(--transition);
        }

        .item-card:hover {
            background: var(--color-border);
        }

        .item-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .item-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text);
        }

        .item-meta {
            font-size: 12px;
            color: var(--color-text-muted);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .item-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: var(--color-accent-light);
            color: var(--color-accent);
            font-size: 11px;
            font-weight: 500;
            border-radius: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 32px 16px;
            color: var(--color-text-muted);
        }

        .empty-state-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 12px;
            background: var(--color-bg);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-state-icon svg {
            width: 24px;
            height: 24px;
            color: var(--color-text-muted);
        }

        .empty-state-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }

        .empty-state-text {
            font-size: 13px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 20px;
        }

        .stat-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-secondary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--color-text);
            letter-spacing: -0.02em;
        }

        .stat-value.highlight {
            color: var(--color-success);
        }

        /* Results */
        #results {
            display: none;
        }

        .results-header {
            margin-bottom: 24px;
        }

        .results-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .results-subtitle {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        .panels-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 24px;
        }

        .panel-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: 14px;
        }

        .panel-chip-count {
            font-weight: 600;
            color: var(--color-accent);
        }

        #svg-container {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: 24px;
            overflow-x: auto;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 80px 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        /* Welcome */
        #welcome {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            text-align: center;
            padding: 40px;
        }

        .welcome-banner {
            max-width: 280px;
            height: auto;
            margin-bottom: 24px;
            border-radius: var(--radius-lg);
        }

        .welcome-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 8px;
        }

        .welcome-text {
            font-size: 14px;
            color: var(--color-text-secondary);
            max-width: 400px;
            line-height: 1.6;
        }

        /* Alerts */
        .alert {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            margin-bottom: 16px;
            font-size: 14px;
            animation: slideIn 0.2s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-error {
            background: var(--color-danger-light);
            color: var(--color-danger);
        }

        .alert-success {
            background: var(--color-success-light);
            color: var(--color-success);
        }

        .alert-info {
            background: var(--color-accent-light);
            color: var(--color-accent);
        }

        /* Divider */
        .divider {
            height: 1px;
            background: var(--color-border);
            margin: 16px 0;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--color-border);
            }

            .results-area {
                height: auto;
            }
        }

        /* Collapsible sections */
        .collapsible-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 12px;
            background: var(--color-bg);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--color-text-secondary);
            transition: all var(--transition);
        }

        .collapsible-trigger:hover {
            background: var(--color-border);
            color: var(--color-text);
        }

        .collapsible-trigger svg {
            width: 16px;
            height: 16px;
            transition: transform var(--transition);
        }

        .collapsible-trigger.open svg {
            transform: rotate(180deg);
        }

        .collapsible-content {
            display: none;
            padding-top: 12px;
        }

        .collapsible-content.open {
            display: block;
        }

        /* Select styling */
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 40px;
        }

        /* Actions row */
        .actions-row {
            display: flex;
            gap: 8px;
        }

        .actions-row .btn {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="app">
        <nav class="navbar">
            <a href="#" class="navbar-brand">
                <svg class="navbar-logo-img" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g transform="translate(32, 32)">
                        <rect x="0" y="0" width="280" height="280" rx="20" fill="#CE412B" />
                        <rect x="300" y="0" width="148" height="448" rx="20" fill="#2C3E50" />
                        <rect x="0" y="300" width="280" height="148" rx="20" fill="#DEA584" />
                    </g>
                </svg>
                <span class="navbar-title">OpenOptimizer</span>
            </a>
            <div class="navbar-actions">
                <a href="docs/" class="btn btn-ghost">Documentation</a>
                <a href="https://github.com/openoptimizer/openoptimizer" target="_blank" class="btn btn-secondary btn-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    GitHub
                </a>
            </div>
        </nav>
        
        <div class="main-content">
            <aside class="sidebar">
                <!-- Configuration -->
                <div class="sidebar-section">
                    <div class="sidebar-header">
                        <span class="sidebar-title">Configuration</span>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="cut-width">Cut Width (Kerf)</label>
                        <input type="number" id="cut-width" class="form-input" value="2" min="0" step="0.1">
                        <p class="form-hint">Width of the saw blade cut in mm</p>
                    </div>

                    <div class="checkbox-field">
                        <input type="checkbox" id="min-initial-usage">
                        <div class="checkbox-content">
                            <label class="checkbox-label" for="min-initial-usage">Cluster items on panels</label>
                            <p class="checkbox-hint">Fill current panel before starting a new one</p>
                        </div>
                    </div>

                    <div class="checkbox-field" style="margin-top: 8px;">
                        <input type="checkbox" id="optimize-reusable-remnants">
                        <div class="checkbox-content">
                            <label class="checkbox-label" for="optimize-reusable-remnants">Optimize for reusable remnants</label>
                            <p class="checkbox-hint">Group cuts to leave large reusable offcuts</p>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label" for="min-reusable-remnant-size">Min. remnant area (sq units)</label>
                        <input type="number" id="min-reusable-remnant-size" class="form-input" placeholder="e.g. 10000" min="0" step="1">
                        <p class="form-hint">Leave blank to skip remnant tracking</p>
                    </div>
                </div>

                <!-- Panel Types -->
                <div class="sidebar-section">
                    <div class="sidebar-header">
                        <span class="sidebar-title">Panel Types</span>
                        <span class="sidebar-badge" id="panel-count">1</span>
                    </div>
                    
                    <div id="panel-list" class="item-list" style="max-height: 180px; overflow-y: auto; margin-bottom: 16px;"></div>
                    
                    <button class="collapsible-trigger" onclick="toggleCollapsible(this)">
                        <span>Add panel type</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m6 9 6 6 6-6"/>
                        </svg>
                    </button>
                    <div class="collapsible-content">
                        <div class="form-group">
                            <input type="text" id="panel-id" class="form-input" placeholder="Panel ID (e.g., plywood_4x8)">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="number" id="panel-width" class="form-input" placeholder="Width" value="2400">
                            </div>
                            <div class="form-group">
                                <input type="number" id="panel-height" class="form-input" placeholder="Height" value="1200">
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="number" id="panel-trimming" class="form-input" placeholder="Edge trimming (0)" value="0" min="0" step="0.1">
                            <p class="form-hint">Border reserved on each edge</p>
                        </div>
                        <button class="btn btn-secondary btn-block" onclick="addPanel()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 5v14"/>
                                <path d="M5 12h14"/>
                            </svg>
                            Add Panel
                        </button>
                    </div>
                </div>
                
                <!-- Items -->
                <div class="sidebar-section">
                    <div class="sidebar-header">
                        <span class="sidebar-title">Items to Cut</span>
                        <span class="sidebar-badge" id="item-count">0</span>
                    </div>
                    
                    <div id="items-list" class="item-list" style="max-height: 200px; overflow-y: auto; margin-bottom: 16px;"></div>
                    
                    <button class="collapsible-trigger" onclick="toggleCollapsible(this)">
                        <span>Add item</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="m6 9 6 6 6-6"/>
                        </svg>
                    </button>
                    <div class="collapsible-content">
                        <div class="form-group">
                            <input type="text" id="item-id" class="form-input" placeholder="Item ID (e.g., shelf_600x300)">
                        </div>
                        <div class="form-row-3">
                            <div class="form-group">
                                <input type="number" id="item-width" class="form-input" placeholder="Width" value="600">
                            </div>
                            <div class="form-group">
                                <input type="number" id="item-height" class="form-input" placeholder="Height" value="300">
                            </div>
                            <div class="form-group">
                                <input type="number" id="item-quantity" class="form-input" placeholder="Qty" value="1" min="1">
                            </div>
                        </div>
                        <div class="checkbox-field" style="margin-bottom: 12px;">
                            <input type="checkbox" id="item-can-rotate" checked>
                            <div class="checkbox-content">
                                <label class="checkbox-label" for="item-can-rotate">Can rotate 90°</label>
                            </div>
                        </div>
                        <button class="btn btn-secondary btn-block" onclick="addItem()">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 5v14"/>
                                <path d="M5 12h14"/>
                            </svg>
                            Add Item
                        </button>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="sidebar-section">
                    <button class="btn btn-primary btn-block" id="optimize-btn" onclick="runOptimization()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        Run Optimization
                    </button>
                    
                    <div class="divider"></div>
                    
                    <div class="form-group">
                        <label class="form-label" for="example-select">Load Example</label>
                        <select id="example-select" class="form-input form-select" onchange="updateExampleDescription()"></select>
                        <p class="form-hint" id="example-description">Choose an example to preload</p>
                    </div>
                    
                    <div class="actions-row">
                        <button class="btn btn-secondary" onclick="loadSelectedExample()">Load</button>
                        <button class="btn btn-secondary" onclick="clearAll()">Clear All</button>
                    </div>
                </div>
            </aside>
            
            <main class="results-area">
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p class="loading-text">Running optimization...</p>
                </div>
                
                <div id="results">
                    <div class="results-header">
                        <h1 class="results-title">Optimization Results</h1>
                        <p class="results-subtitle">Layout calculated successfully</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Total Panels</div>
                            <div class="stat-value" id="total-panels">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Material Waste</div>
                            <div class="stat-value highlight" id="waste">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Used Area</div>
                            <div class="stat-value" id="used-area">-</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Area</div>
                            <div class="stat-value" id="total-area">-</div>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h3 class="card-title">Panels Required</h3>
                        </div>
                        <div class="card-body">
                            <div id="panels-required" class="panels-grid"></div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Cutting Layout</h3>
                            <button class="btn btn-secondary btn-sm" onclick="downloadResults()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" x2="12" y1="15" y2="3"/>
                                </svg>
                                Export JSON
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="svg-container"></div>
                        </div>
                    </div>
                </div>
                
                <div id="welcome">
                    <svg class="welcome-banner" viewBox="0 0 512 512" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g transform="translate(32, 32)">
                            <rect x="0" y="0" width="280" height="280" rx="20" fill="#CE412B" />
                            <rect x="300" y="0" width="148" height="448" rx="20" fill="#2C3E50" />
                            <rect x="0" y="300" width="280" height="148" rx="20" fill="#DEA584" />
                        </g>
                    </svg>
                    <h2 class="welcome-title">Ready to optimize</h2>
                    <p class="welcome-text">
                        Add panel types and items in the sidebar, then click <strong>Run Optimization</strong> to calculate the most efficient cutting layout. Or load an example to get started.
                    </p>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        const API_BASE = '/api';

        const EXAMPLES = {
            simple: {
                label: 'Simple Shelves',
                description: 'Single panel type with three shelf/back parts.',
                cutWidth: 5,
                minInitialUsage: false,
                optimizeReusableRemnants: false,
                minReusableRemnantSize: null,
                panels: [
                    { id: 'std_panel', width: 2440, height: 1220, trimming: 0 }
                ],
                items: [
                    { id: 'shelf_a', width: 600, height: 300, quantity: 4, can_rotate: true },
                    { id: 'shelf_b', width: 800, height: 400, quantity: 2, can_rotate: true },
                    { id: 'back_panel', width: 1200, height: 600, quantity: 1, can_rotate: false }
                ]
            },
            complex: {
                label: 'Cabinet Build',
                description: 'Multi-panel cabinet job with various parts.',
                cutWidth: 4,
                minInitialUsage: false,
                optimizeReusableRemnants: false,
                minReusableRemnantSize: null,
                panels: [
                    { id: 'mdf_8x4', width: 2440, height: 1220, trimming: 0 },
                    { id: 'mdf_6x3', width: 1830, height: 915, trimming: 0 },
                    { id: 'mdf_4x2', width: 1220, height: 610, trimming: 0 }
                ],
                items: [
                    { id: 'cabinet_side', width: 800, height: 600, quantity: 8, can_rotate: true },
                    { id: 'cabinet_shelf', width: 780, height: 400, quantity: 12, can_rotate: true },
                    { id: 'cabinet_door', width: 400, height: 800, quantity: 4, can_rotate: false },
                    { id: 'drawer_side', width: 500, height: 150, quantity: 8, can_rotate: true },
                    { id: 'drawer_bottom', width: 480, height: 480, quantity: 4, can_rotate: true }
                ]
            },
            furniture: {
                label: 'Furniture Bundle',
                description: 'Bookshelf and desk workload combined.',
                cutWidth: 3,
                minInitialUsage: true,
                optimizeReusableRemnants: false,
                minReusableRemnantSize: null,
                panels: [
                    { id: 'plywood_8x4', width: 2440, height: 1220, trimming: 5 },
                    { id: 'plywood_6x4', width: 1830, height: 1220, trimming: 0 }
                ],
                items: [
                    { id: 'shelf_long', width: 900, height: 300, quantity: 6, can_rotate: true },
                    { id: 'shelf_short', width: 600, height: 300, quantity: 4, can_rotate: true },
                    { id: 'side_panel', width: 1800, height: 400, quantity: 4, can_rotate: false },
                    { id: 'back_panel', width: 900, height: 1750, quantity: 2, can_rotate: false },
                    { id: 'desktop', width: 1400, height: 700, quantity: 1, can_rotate: true },
                    { id: 'desk_leg', width: 700, height: 70, quantity: 4, can_rotate: false },
                    { id: 'drawer_front', width: 450, height: 200, quantity: 3, can_rotate: true }
                ]
            }
        };
        
        let panels = [
            { id: 'standard_plywood_4x8', width: 2400, height: 1200, trimming: 0 }
        ];
        let items = [];
        let currentResult = null;

        function toggleCollapsible(trigger) {
            trigger.classList.toggle('open');
            const content = trigger.nextElementSibling;
            content.classList.toggle('open');
        }

        function updateCounts() {
            document.getElementById('panel-count').textContent = panels.length;
            document.getElementById('item-count').textContent = items.reduce((sum, item) => sum + item.quantity, 0);
        }
        
        function addPanel() {
            const id = document.getElementById('panel-id').value.trim();
            const width = parseFloat(document.getElementById('panel-width').value);
            const height = parseFloat(document.getElementById('panel-height').value);
            const trimmingInput = document.getElementById('panel-trimming');
            const trimmingRaw = trimmingInput.value.trim();
            const trimming = trimmingRaw === '' ? 0 : parseFloat(trimmingRaw);
            
            if (!id || !width || !height) {
                showAlert('Please fill in all required panel fields', 'error');
                return;
            }

            if (isNaN(trimming) || trimming < 0) {
                showAlert('Trimming must be a non-negative number', 'error');
                return;
            }
            
            panels.push({ id, width, height, trimming });
            renderPanels();
            
            document.getElementById('panel-id').value = '';
            trimmingInput.value = '0';
        }
        
        function removePanel(index) {
            panels.splice(index, 1);
            renderPanels();
        }
        
        function renderPanels() {
            const list = document.getElementById('panel-list');
            updateCounts();
            
            if (panels.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                            </svg>
                        </div>
                        <p class="empty-state-title">No panels defined</p>
                        <p class="empty-state-text">Add a panel type to get started</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = panels.map((p, i) => `
                <div class="item-card">
                    <div class="item-info">
                        <span class="item-name">${p.id}</span>
                        <span class="item-meta">
                            ${p.width} × ${p.height} mm
                            ${p.trimming > 0 ? `<span class="item-tag">trim: ${p.trimming}</span>` : ''}
                        </span>
                    </div>
                    <button class="btn btn-icon btn-ghost" onclick="removePanel(${i})" title="Remove">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 6 6 18"/>
                            <path d="m6 6 12 12"/>
                        </svg>
                    </button>
                </div>
            `).join('');
        }
        
        function addItem() {
            const id = document.getElementById('item-id').value.trim();
            const width = parseFloat(document.getElementById('item-width').value);
            const height = parseFloat(document.getElementById('item-height').value);
            const quantity = parseInt(document.getElementById('item-quantity').value);
            const canRotate = document.getElementById('item-can-rotate').checked;
            
            if (!id || !width || !height || !quantity) {
                showAlert('Please fill in all required item fields', 'error');
                return;
            }
            
            items.push({ id, width, height, quantity, can_rotate: canRotate });
            renderItems();
            
            document.getElementById('item-id').value = '';
            document.getElementById('item-quantity').value = '1';
        }
        
        function removeItem(index) {
            items.splice(index, 1);
            renderItems();
        }
        
        function renderItems() {
            const list = document.getElementById('items-list');
            updateCounts();
            
            if (items.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/>
                                <path d="m3.3 7 8.7 5 8.7-5"/>
                                <path d="M12 22V12"/>
                            </svg>
                        </div>
                        <p class="empty-state-title">No items added</p>
                        <p class="empty-state-text">Add items to cut from panels</p>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = items.map((item, i) => `
                <div class="item-card">
                    <div class="item-info">
                        <span class="item-name">${item.id}</span>
                        <span class="item-meta">
                            ${item.width} × ${item.height} mm
                            <span class="item-tag">×${item.quantity}</span>
                            ${item.can_rotate ? '<span class="item-tag">rotatable</span>' : ''}
                        </span>
                    </div>
                    <button class="btn btn-icon btn-ghost" onclick="removeItem(${i})" title="Remove">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 6 6 18"/>
                            <path d="m6 6 12 12"/>
                        </svg>
                    </button>
                </div>
            `).join('');
        }
        
        async function runOptimization() {
            if (panels.length === 0) {
                showAlert('Please add at least one panel type', 'error');
                return;
            }
            
            if (items.length === 0) {
                showAlert('Please add at least one item', 'error');
                return;
            }
            
            const minRemnantInput = document.getElementById('min-reusable-remnant-size').value.trim();
            const minReusableRemnantSize = minRemnantInput === '' ? null : parseFloat(minRemnantInput);
            if (minReusableRemnantSize !== null && (isNaN(minReusableRemnantSize) || minReusableRemnantSize < 0)) {
                showAlert('Minimum reusable remnant area must be a positive number', 'error');
                return;
            }

            const request = {
                cut_width: parseFloat(document.getElementById('cut-width').value),
                min_initial_usage: document.getElementById('min-initial-usage').checked,
                optimize_for_reusable_remnants: document.getElementById('optimize-reusable-remnants').checked,
                panel_types: panels,
                items: items,
                min_reusable_remnant_size: minReusableRemnantSize
            };
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            document.getElementById('welcome').style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/optimize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(request)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Optimization failed');
                }
                
                const result = await response.json();
                currentResult = result;
                displayResults(result);
                
            } catch (error) {
                showAlert('Optimization failed: ' + error.message, 'error');
                document.getElementById('welcome').style.display = 'flex';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        async function displayResults(result) {
            document.getElementById('total-panels').textContent = result.summary.total_panels;
            document.getElementById('waste').textContent = result.summary.waste_percentage.toFixed(1) + '%';
            document.getElementById('used-area').textContent = (result.summary.used_area / 1000000).toFixed(2) + ' m²';
            document.getElementById('total-area').textContent = (result.summary.total_area / 1000000).toFixed(2) + ' m²';
            
            const panelsReq = document.getElementById('panels-required');
            panelsReq.innerHTML = Object.entries(result.panels_required).map(([id, count]) => `
                <div class="panel-chip">
                    <span>${id}</span>
                    <span class="panel-chip-count">×${count}</span>
                </div>
            `).join('');
            
            try {
                const svgResponse = await fetch(`${API_BASE}/generate/svg`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(result)
                });
                
                if (svgResponse.ok) {
                    const svgText = await svgResponse.text();
                    document.getElementById('svg-container').innerHTML = svgText;
                }
            } catch (error) {
                console.error('Failed to generate SVG:', error);
            }
            
            document.getElementById('results').style.display = 'block';
            showAlert('Optimization completed successfully!', 'success');
        }
        
        function populateExampleSelect() {
            const select = document.getElementById('example-select');
            select.innerHTML = Object.entries(EXAMPLES)
                .map(([key, example]) => `<option value="${key}">${example.label}</option>`)
                .join('');
            select.value = Object.keys(EXAMPLES)[0];
        }

        function updateExampleDescription() {
            const select = document.getElementById('example-select');
            const example = EXAMPLES[select.value];
            const descEl = document.getElementById('example-description');
            if (example && descEl) {
                descEl.textContent = example.description;
            }
        }

        function loadSelectedExample() {
            const select = document.getElementById('example-select');
            loadExample(select.value);
        }

        function loadExample(key) {
            const example = EXAMPLES[key];
            if (!example) {
                showAlert('Unknown example selected.', 'error');
                return;
            }

            panels = example.panels.map(panel => ({ ...panel }));
            items = example.items.map(item => ({ ...item }));

            document.getElementById('cut-width').value = example.cutWidth;
            document.getElementById('min-initial-usage').checked = example.minInitialUsage;
            document.getElementById('optimize-reusable-remnants').checked = example.optimizeReusableRemnants;
            const remnantInput = document.getElementById('min-reusable-remnant-size');
            remnantInput.value = example.minReusableRemnantSize ?? '';
            
            renderPanels();
            renderItems();
            showAlert(`"${example.label}" loaded. Click Run Optimization to see results.`, 'info');
        }
        
        function clearAll() {
            if (confirm('Clear all panels and items?')) {
                panels = [];
                items = [];
                renderPanels();
                renderItems();
                document.getElementById('min-initial-usage').checked = false;
                document.getElementById('optimize-reusable-remnants').checked = false;
                document.getElementById('min-reusable-remnant-size').value = '';
                document.getElementById('panel-trimming').value = '0';
                document.getElementById('results').style.display = 'none';
                document.getElementById('welcome').style.display = 'flex';
            }
        }
        
        function downloadResults() {
            if (!currentResult) return;
            
            const blob = new Blob([JSON.stringify(currentResult, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'optimization-result.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function showAlert(message, type) {
            const existing = document.querySelector('.alert');
            if (existing) existing.remove();
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    ${type === 'success' ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>' : 
                      type === 'error' ? '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>' :
                      '<circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>'}
                </svg>
                <span>${message}</span>
            `;
            
            const sidebar = document.querySelector('.sidebar');
            const firstSection = sidebar.querySelector('.sidebar-section');
            sidebar.insertBefore(alertDiv, firstSection);
            
            setTimeout(() => alertDiv.remove(), 4000);
        }
        
        // Initialize
        populateExampleSelect();
        updateExampleDescription();
        renderPanels();
        renderItems();
    </script>
</body>
</html>
